version: "3.8"

networks:
  openwebui_ai-net:
    external: true

services:
  pdf-upload-app:
    build: .
    container_name: pdf-upload-app
    restart: unless-stopped
    networks: 
      - openwebui_ai-net
    ports:
      - "8000:8000"  # Backend API
      - "3001:3001"  # Frontend (if served separately)
    environment:
      # OpenWebUI is accessible via container name on the docker network
      OPENWEBUI_BASE_URL: http://open-webui:8080
      OPENWEBUI_API_KEY: ${OPENWEBUI_API_KEY}
      OPENWEBUI_KB_ID: ${OPENWEBUI_KB_ID}
    volumes:
      # Share the same uploads folder as OpenWebUI
      - /mnt/gcs/fin602:/app/backend/Webscraping/openwebui/data/knowledge_base
      - ./backend/Webscraping/openwebui/data:/app/backend/Webscraping/openwebui/data
    depends_on:
      - nginx
  
  nginx:
    image: nginx:alpine
    container_name: pdf-upload-nginx
    restart: unless-stopped
    networks:
      - openwebui_ai-net
    ports:
      - "8888:80"  # Access everything via port 8888
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./frontend/upload/upload-app/build:/usr/share/nginx/html